<head>
  <link rel="stylesheet" href="/assets/css/dashboard/swiper.css">
  <link rel="stylesheet" href="/assets/css/dashboard/bootstrap5.css">
  <link rel="stylesheet" type="text/css" href="/assets/css/dashboard/vendor.css">
  <link rel="stylesheet" type="text/css" href="/assets/css/dashboard/style.css">
  <style>
    .main-menu {
      width: 100%;
      display: flex;
      justify-content: center;
    }
    .main-menu .navbar-nav.menu-list {
      width: auto;
      justify-content: center !important;
      text-align: center;
      margin: 0 auto !important;
    }
    .main-menu .navbar-nav.menu-list .nav-item {
      flex: 0 0 auto;
      padding: 0 0.75rem;
    }
    .main-menu .offcanvas-body {
      width: 100% !important;
      display: flex !important;
      justify-content: center !important;
      padding: 0 !important;
    }
    @media (max-width: 991.98px) {
      .main-menu .navbar-nav.menu-list {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <!-- --------- Hiệu ứng load trang ------------ -->

  <!-- <div class="preloader-wrapper">
    <div class="preloader">
    </div>
  </div> -->
  <!-- --------- Show nhanh rỏ hàng ------------ -->
  <div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasCart"
    aria-labelledby="My Cart" style="width: 900px;">
    <div class="offcanvas-header justify-content-between">
      <h5 class="mb-0">Giỏ hàng</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body" ng-if="isLogin">
      <div class="card border-0 h-100 w-100">
        <div class="row g-0 h-100">
          <div class="col-lg-8 border-end">
            <div class="p-4 h-100 d-flex flex-column">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h5 class="fw-bold mb-0">Sản phẩm trong giỏ</h5>
                <span class="badge bg-primary rounded-pill">{{getCartCount()}} sản phẩm</span>
              </div>
              <div class="text-center text-muted py-5" ng-if="cartLoading">
                <div class="spinner-border text-primary mb-3" role="status"></div>
                <p class="mb-0">Đang tải giỏ hàng...</p>
              </div>
              <div class="list-group list-group-flush flex-grow-1"
                ng-if="!cartLoading && cartItems.length">
                <div class="list-group-item px-0 py-3 d-flex align-items-center"
                  ng-repeat="item in cartItems track by item.id">
                  <img ng-src="{{resolveCartImage(item)}}" class="rounded-3 me-3" width="64" alt="Ảnh sản phẩm" />
                  <div class="flex-grow-1">
                    <h6 class="mb-1">{{item.product.name}}</h6>
                    <small class="text-muted">Mã SP: {{item.product.code || ('MS' + item.product.id)}}</small>
                    <div class="d-flex align-items-center mt-2">
                      <input type="number" class="form-control form-control-sm me-3" min="1"
                        ng-model="item.amount" ng-change="checkCartQuantity(item)">
                      <button class="btn btn-sm btn-link text-danger p-0" type="button"
                        ng-click="removeCartItem(item)">
                        Xóa
                      </button>
                    </div>
                  </div>
                  <span class="fw-semibold">${{item.product.price}}</span>
                </div>
              </div>
              <div class="text-center text-muted py-5" ng-if="!cartLoading && !cartItems.length">
                <p class="mb-1">Giỏ hàng của bạn đang trống.</p>
                <small>Hãy thêm sản phẩm để thanh toán nhanh.</small>
              </div>
            </div>
          </div>
          <div class="col-lg-4 bg-light">
            <div class="p-4 h-100 d-flex flex-column">
              <h5 class="fw-bold">Tổng kết</h5>
              <div class="alert alert-success py-2" ng-if="cartNotice">
                {{cartNotice}}
              </div>
              <div class="alert alert-danger py-2" ng-if="cartError">
                {{cartError}}
              </div>
              <div class="d-flex justify-content-between mt-3">
                <span>Tạm tính</span>
                <span>${{getCartTotal()}}</span>
              </div>
              <div class="d-flex justify-content-between">
                <span>Giảm giá</span>
                <span>$0</span>
              </div>
              <hr>
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-semibold">Tổng cộng</span>
                <span class="fw-bold fs-5 text-primary">${{getCartTotal()}}</span>
              </div>
              <button class="btn btn-primary w-100 mt-4" ng-click="openCheckoutModal()"
                ng-disabled="cartProcessing || cartLoading || !cartItems.length">
                <span ng-if="!cartProcessing">Thanh toán</span>
                <span ng-if="cartProcessing" class="d-inline-flex align-items-center justify-content-center">
                  <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                  Đang xử lý...
                </span>
              </button>
              <small class="text-muted d-block mt-2">Phí vận chuyển được tính ở bước tiếp theo.</small>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="offcanvas-body d-flex align-items-center justify-content-center" ng-if="!isLogin">
      <div class="text-center">
        <p class="mb-3">Vui lòng đăng nhập để xem giỏ hàng.</p>
        <a ng-href="/#!/login" class="btn btn-primary">Đăng nhập</a>
      </div>
    </div>
  </div>
  <!-- --------- Menu bar ------------ -->
  <header>
    <div class="container-fluid">
      <div class="row py-3 border-bottom">

        <div class="col-sm-4 col-lg-3 text-center text-sm-start">
          <div class="main-logo">
            <a href="index.html">
              <img src="/assets/images/logo-dark.png" alt="logo" class="img-fluid" style="max-height: 50px;">
            </a>
          </div>
        </div>

        <div class="col-sm-6 offset-sm-2 offset-md-0 col-lg-5 d-none d-lg-block">
          <div class="search-bar row bg-light p-2 my-2 rounded-4">
            <div class="col-md-4 d-none d-md-block">
              <select class="form-select border-0 bg-transparent" ng-model="selectedNavCategory">
                <option value="" selected>Danh mục</option>
                <option ng-repeat="cate in categories" value="{{cate.id}}">
                  {{cate.name}}
                </option>
              </select>
            </div>
            <div class="col-11 col-md-7">
              <form id="search-form" class="text-center" action="index.html" method="post">
                <input type="text" class="form-control border-0 bg-transparent" placeholder="Bạn muốn tìm gì?" />
              </form>
            </div>
            <div class="col-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 7-7a7 7 0 0 1-7 7Z" />
              </svg>
            </div>
          </div>
        </div>

        <div
          class="col-sm-8 col-lg-4 d-flex justify-content-end gap-5 align-items-center mt-4 mt-sm-0 justify-content-center justify-content-sm-end">
          <ul class="d-flex justify-content-end list-unstyled m-0">
            <li class="d-lg-none" ng-if="isLogin">
              <a href="javascript:void(0)" class="rounded-circle bg-light p-2 mx-1" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasCart" aria-controls="offcanvasCart" ng-click="prepareCart($event)">
                <svg width="24" height="24" viewBox="0 0 24 24">
                  <use xlink:href="#cart"></use>
                </svg>
              </a>
            </li>
            <li class="d-lg-none">
              <a href="#" class="rounded-circle bg-light p-2 mx-1" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasSearch" aria-controls="offcanvasSearch">
                <svg width="24" height="24" viewBox="0 0 24 24">
                  <use xlink:href="#search"></use>
                </svg>
              </a>
            </li>
          </ul>

          <div class="cart text-end d-none d-lg-block dropdown">
            <button ng-if="isLogin" class="border-0 bg-transparent d-flex flex-column gap-2 lh-1" type="button"
              data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart" aria-controls="offcanvasCart"
              ng-click="prepareCart($event)">
              <span class="fs-6 text-muted dropdown-toggle">Giỏ Hàng ({{getCartCount()}})</span>
            </button>
            <a ng-if="!isLogin" ng-href="/#!/login" class="btn btn-outline-primary btn-sm">Đăng nhập để xem giỏ hàng</a>
          </div>

          <div class="cart text-end d-none d-lg-block dropdown">
            <div class="dropdown d-inline-block">
              <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown"
                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="d-none d-xl-inline-block ms-1" key="t-henry"><i class="bi bi-person-fill"></i>
                  {{nameUser}}</span>
                <i class="mdi mdi-chevron-down d-none d-xl-inline-block"></i>
              </button>
              <div class="dropdown-menu dropdown-menu-end">
                <a ng-if="isLogin" class="dropdown-item text-danger fw-semibold" href="#" ng-click="logout()">
                  <i class="bx bx-power-off font-size-16 align-middle me-1 text-danger"></i>
                  <span key="t-logout">Logout</span></a>
                <a ng-if="!isLogin" class="dropdown-item text-success fw-semibold" ng-href="/#!/login">
                  <i class="bx bx-power-off font-size-16 align-middle me-1 text-success"></i>
                  <span key="t-logout">Login</span></a>
              </div>
            </div>
          </div>



        </div>

      </div>
    </div>
    <div class="container-fluid">
      <div class="row py-3">
        <div class="d-flex  justify-content-center justify-content-sm-between align-items-center">
          <nav class="main-menu d-flex navbar navbar-expand-lg">

            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
              aria-controls="offcanvasNavbar">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar"
              aria-labelledby="offcanvasNavbarLabel">

              <div class="offcanvas-header justify-content-center">
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
              </div>

              <div class="offcanvas-body d-flex justify-content-center">

                <ul
                  class="navbar-nav menu-list list-unstyled d-flex gap-md-3 mb-0 text-uppercase w-100 justify-content-center text-center"
                  style="justify-content: center !important;">
                  <li class="nav-item">
                    <a ng-href="/#!/" class="nav-link" ng-class="{'fw-bold text-primary': pageSection === 'home'}">Trang chủ</a>
                  </li>
                  <li class="nav-item">
                    <a ng-href="/#!/products" class="nav-link"
                      ng-class="{'fw-bold text-primary': pageSection === 'products'}">Sản phẩm</a>
                  </li>
                  <li class="nav-item">
                    <a ng-href="/#!/about" class="nav-link"
                      ng-class="{'fw-bold text-primary': pageSection === 'about'}">Giới thiệu</a>
                  </li>
                  <li class="nav-item">
                    <a ng-href="/#!/news" class="nav-link"
                      ng-class="{'fw-bold text-primary': pageSection === 'news'}">Tin tức</a>
                  </li>
                  <li class="nav-item">
                    <a ng-href="/#!/contact" class="nav-link"
                      ng-class="{'fw-bold text-primary': pageSection === 'contact'}">Liên hệ</a>
                  </li>
                  <li class="nav-item">
                    <a ng-href="/#!/career" class="nav-link"
                      ng-class="{'fw-bold text-primary': pageSection === 'career'}">Tuyển dụng</a>
                  </li>
                </ul>

              </div>

            </div>
        </div>
      </div>
    </div>
  </header>
  <!-- --------- Menu bar ------------ -->


    <div ng-include="pageTemplate"></div>


  <!-- --------- Checkout Modal ------------ -->
  <div class="modal fade" id="cartCheckoutModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Thanh toán</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            ng-disabled="cartProcessing"></button>
        </div>
        <div class="modal-body">
          <div class="row g-4">
            <div class="col-lg-7">
              <h5 class="text-success fw-bold mb-3">Thông tin người mua</h5>
              <p class="mb-1"><strong>Họ tên:</strong> {{account.fullName || nameUser}}</p>
              <p class="mb-1"><strong>Số điện thoại:</strong> {{account.phoneNumber || 'Chưa cập nhật'}}</p>
              <p class="mb-1"><strong>Email:</strong> {{account.email || 'Chưa cập nhật'}}</p>
              <p class="mb-3"><strong>Địa chỉ:</strong> {{account.address || 'Chưa cập nhật'}}</p>
              <hr>
              <h6 class="fw-bold mb-2">Thanh toán QR</h6>
              <p class="small text-muted">Sử dụng mã QR dưới đây để hoàn tất thanh toán. Nội dung:
                {{nameUser}} - {{account.phoneNumber || 'N/A'}}</p>
              <img src="/assets/images/qrNganHang.jpg" class="img-fluid rounded-3" alt="QR thanh toán">
            </div>
            <div class="col-lg-5">
              <h5 class="fw-bold">Chi tiết đơn hàng</h5>
              <div class="bg-body-tertiary rounded-3 p-3 mb-3" style="max-height: 320px; overflow-y: auto;">
                <div class="d-flex justify-content-between py-2 border-bottom small"
                  ng-repeat="it in cartItems track by it.id">
                  <span>{{it.product.name}}</span>
                  <span>${{it.product.price}}</span>
                </div>
                <p class="text-center text-muted my-3" ng-if="!cartItems.length">Giỏ hàng trống.</p>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-semibold">Tổng cộng</span>
                <span class="fw-bold text-primary fs-4">${{getCartTotal()}}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" ng-click="performCheckout()" ng-disabled="cartProcessing">
            <span ng-if="!cartProcessing">Hoàn tất</span>
            <span ng-if="cartProcessing" class="d-inline-flex align-items-center">
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              Đang xử lý...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer class="py-5 bg-dark text-light mt-5">
    <div class="container">
      <div class="row g-4">
        <div class="col-lg-4">
          <img src="/assets/images/logo-light.png" alt="logo" class="mb-3" style="height: 48px;">
          <p class="text-white-50">Hệ thống mua sắm thiết bị y tế – cung cấp sản phẩm chính hãng, dịch vụ tư vấn tận tâm và
            giao hàng nhanh chóng.</p>
          <div class="d-flex gap-2">
            <button class="btn btn-outline-light btn-sm"><i class="bi bi-facebook"></i></button>
            <button class="btn btn-outline-light btn-sm"><i class="bi bi-youtube"></i></button>
            <button class="btn btn-outline-light btn-sm"><i class="bi bi-instagram"></i></button>
          </div>
        </div>
        <div class="col-sm-4 col-lg-2">
          <h6 class="text-uppercase fw-bold mb-3 text-light">Thông tin</h6>
          <ul class="list-unstyled small">
            <li><a ng-href="/#!/about" class="text-white-50 text-decoration-none">Giới thiệu</a></li>
            <li><a ng-href="/#!/news" class="text-white-50 text-decoration-none">Tin tức</a></li>
            <li><a ng-href="/#!/career" class="text-white-50 text-decoration-none">Tuyển dụng</a></li>
          </ul>
        </div>
        <div class="col-sm-4 col-lg-3">
          <h6 class="text-uppercase fw-bold mb-3 text-light">Hỗ trợ</h6>
          <ul class="list-unstyled small text-white-50">
            <li>Hotline: 1900 1234</li>
            <li>Email: support@medicalshop.vn</li>
            <li>Thời gian: 08:00 - 21:00 (T2 - CN)</li>
          </ul>
        </div>
        <div class="col-sm-4 col-lg-3">
          <h6 class="text-uppercase fw-bold mb-3 text-light">Đăng ký nhận tin</h6>
          <p class="text-white-50 small">Nhận thông tin khuyến mãi và sản phẩm mới mỗi tuần.</p>
          <form class="d-flex gap-2">
            <input type="email" class="form-control form-control-sm" placeholder="Email của bạn">
            <button type="submit" class="btn btn-primary btn-sm">Gửi</button>
          </form>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
    crossorigin="anonymous"></script>
</body>

</html>
